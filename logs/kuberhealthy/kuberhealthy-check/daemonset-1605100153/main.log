time="2020-11-11T13:09:20Z" level=info msg="Found instance namespace: kuberhealthy"
time="2020-11-11T13:09:20Z" level=info msg="Kuberhealthy is located in the kuberhealthy namespace."
time="2020-11-11T13:09:20Z" level=info msg="Setting shutdown grace period to: 1m0s"
time="2020-11-11T13:09:20Z" level=info msg="Check deadline in 10m53.427187182s"
time="2020-11-11T13:09:20Z" level=info msg="Parsed POD_NAMESPACE: kuberhealthy"
time="2020-11-11T13:09:20Z" level=info msg="Performing check in kuberhealthy namespace."
time="2020-11-11T13:09:20Z" level=info msg="Setting DS pause container image to: gcr.io/google-containers/pause:3.1"
time="2020-11-11T13:09:20Z" level=info msg="Setting check daemonset name to: daemonset"
time="2020-11-11T13:09:20Z" level=info msg="Setting check priority class name to: "
time="2020-11-11T13:09:20Z" level=info msg="Kubernetes client created."
time="2020-11-11T13:09:20Z" level=debug msg="Getting pod: daemonset-1605100153 in order to get its node information"
time="2020-11-11T13:09:20Z" level=debug msg="Pod is on node: gke-****-tekton-default-pool-154aeb80-pmxj"
time="2020-11-11T13:09:20Z" level=error msg="Error waiting for node to reach minimum age:nodes \"gke-****-tekton-default-pool-154aeb80-pmxj\" is forbidden: User \"system:serviceaccount:kuberhealthy:daemonset-khcheck\" cannot get resource \"nodes\" in API group \"\" at the cluster scope"
time="2020-11-11T13:09:20Z" level=debug msg="Checking if the kuberhealthy endpoint: http://kuberhealthy.kuberhealthy.svc.cluster.local/externalCheckStatus is ready."
time="2020-11-11T13:09:20Z" level=debug msg="http://kuberhealthy.kuberhealthy.svc.cluster.local/externalCheckStatus is ready."
time="2020-11-11T13:09:20Z" level=debug msg="Kuberhealthy endpoint: http://kuberhealthy.kuberhealthy.svc.cluster.local/externalCheckStatus is ready. Proceeding to run check."
time="2020-11-11T13:09:20Z" level=debug msg="Getting pod: daemonset-1605100153 in order to get its node information"
time="2020-11-11T13:09:20Z" level=debug msg="Checking if kube-proxy is running and ready on this node: gke-****-tekton-default-pool-154aeb80-pmxj"
time="2020-11-11T13:09:20Z" level=error msg="Error waiting for kube proxy to be ready and running on the node with error:Failed to get kube-proxy pod: kube-proxy-gke-****-tekton-default-pool-154aeb80-pmxj. Error: pods \"kube-proxy-gke-****-tekton-default-pool-154aeb80-pmxj\" is forbidden: User \"system:serviceaccount:kuberhealthy:daemonset-khcheck\" cannot get resource \"pods\" in API group \"\" in the namespace \"kube-system\""
time="2020-11-11T13:09:20Z" level=debug msg="Allowing this check until 2020-11-11 13:20:14 +0000 UTC to finish."
time="2020-11-11T13:09:20Z" level=debug msg="Setting check ctx cancel with timeout 11m53.427187182s"
time="2020-11-11T13:09:20Z" level=info msg="Running daemonset check"
time="2020-11-11T13:09:20Z" level=info msg="Running daemonset deploy..."
time="2020-11-11T13:09:20Z" level=info msg="Deploying daemonset."
time="2020-11-11T13:09:20Z" level=debug msg="runAsUser will be set to  999"
time="2020-11-11T13:09:20Z" level=debug msg="Searching for unique taints on the cluster."
time="2020-11-11T13:09:20Z" level=info msg="Found taints to tolerate: []"
time="2020-11-11T13:09:20Z" level=info msg="Generating daemonset kubernetes spec."
time="2020-11-11T13:09:20Z" level=info msg="Deploying daemonset with tolerations:  []"
time="2020-11-11T13:09:20Z" level=debug msg="Creating Daemonset client."
time="2020-11-11T13:09:20Z" level=debug msg="Worker: waitForPodsToComeOnline started"
time="2020-11-11T13:09:20Z" level=debug msg="Waiting for all ds pods to come online"
time="2020-11-11T13:09:20Z" level=info msg="Timeout set: 10m53.427187182s for all daemonset pods to come online"
time="2020-11-11T13:09:21Z" level=debug msg="Creating Node client."
time="2020-11-11T13:09:21Z" level=debug msg="Creating Pod client."
time="2020-11-11T13:09:21Z" level=info msg="DaemonsetChecker: Daemonset check waiting for 4 pod(s) to come up on nodes [gke-****-tekton-default-pool-154aeb80-ccfi gke-****-tekton-default-pool-154aeb80-n21q gke-****-tekton-default-pool-154aeb80-pmxj gke-****-tekton-nap-n1-standard--0a7ecf20-446q]"
time="2020-11-11T13:09:22Z" level=debug msg="Creating Node client."
time="2020-11-11T13:09:22Z" level=debug msg="Creating Pod client."
time="2020-11-11T13:09:22Z" level=info msg="DaemonsetChecker: Daemonset check waiting for 3 pod(s) to come up on nodes [gke-****-tekton-default-pool-154aeb80-n21q gke-****-tekton-default-pool-154aeb80-pmxj gke-****-tekton-nap-n1-standard--0a7ecf20-446q]"
time="2020-11-11T13:09:23Z" level=debug msg="Creating Node client."
time="2020-11-11T13:09:23Z" level=debug msg="Creating Pod client."
time="2020-11-11T13:09:23Z" level=info msg="DaemonsetChecker: Daemonset check waiting for 1 pod(s) to come up on nodes [gke-****-tekton-default-pool-154aeb80-n21q]"
time="2020-11-11T13:09:24Z" level=debug msg="Creating Node client."
time="2020-11-11T13:09:24Z" level=debug msg="Creating Pod client."
time="2020-11-11T13:09:24Z" level=info msg="DaemonsetChecker: All daemonset pods have been ready for 1 / 5 seconds."
time="2020-11-11T13:09:25Z" level=debug msg="Creating Node client."
time="2020-11-11T13:09:25Z" level=debug msg="Creating Pod client."
time="2020-11-11T13:09:25Z" level=info msg="DaemonsetChecker: All daemonset pods have been ready for 2 / 5 seconds."
time="2020-11-11T13:09:26Z" level=debug msg="Creating Node client."
time="2020-11-11T13:09:26Z" level=debug msg="Creating Pod client."
time="2020-11-11T13:09:27Z" level=info msg="DaemonsetChecker: All daemonset pods have been ready for 3 / 5 seconds."
time="2020-11-11T13:09:28Z" level=debug msg="Creating Node client."
time="2020-11-11T13:09:28Z" level=debug msg="Creating Pod client."
time="2020-11-11T13:09:28Z" level=info msg="DaemonsetChecker: All daemonset pods have been ready for 4 / 5 seconds."
time="2020-11-11T13:09:29Z" level=debug msg="Creating Node client."
time="2020-11-11T13:09:29Z" level=debug msg="Creating Pod client."
time="2020-11-11T13:09:29Z" level=info msg="DaemonsetChecker: All daemonset pods have been ready for 5 / 5 seconds."
time="2020-11-11T13:09:29Z" level=info msg="DaemonsetChecker: Daemonset daemonset-daemonset-1605100153-1605100160 done deploying pods."
time="2020-11-11T13:09:29Z" level=info msg="Successfully deployed daemonset."
time="2020-11-11T13:09:29Z" level=info msg="Running daemonset removal..."
time="2020-11-11T13:09:29Z" level=info msg="Removing daemonset."
time="2020-11-11T13:09:29Z" level=info msg="DaemonsetChecker deleting daemonset: daemonset-daemonset-1605100153-1605100160"
time="2020-11-11T13:09:29Z" level=debug msg="Creating Pod client."
time="2020-11-11T13:09:29Z" level=info msg="There are 4 daemonset pods to remove"
time="2020-11-11T13:09:29Z" level=debug msg="Creating Daemonset client."
time="2020-11-11T13:09:29Z" level=info msg="DaemonsetChecker removing daemonset. Proceeding to remove daemonset pods"
time="2020-11-11T13:09:29Z" level=debug msg="Creating Pod client."
time="2020-11-11T13:09:29Z" level=info msg="Successfully requested daemonset removal."
time="2020-11-11T13:09:29Z" level=debug msg="Worker: waitForDSRemoval started"
time="2020-11-11T13:09:29Z" level=debug msg="Waiting for ds removal"
time="2020-11-11T13:09:29Z" level=info msg="Successfully removed daemonset."
time="2020-11-11T13:09:29Z" level=debug msg="Worker: waitForPodRemoval started"
time="2020-11-11T13:09:29Z" level=debug msg="Waiting for ds pods removal"
time="2020-11-11T13:09:29Z" level=debug msg="Creating Pod client."
time="2020-11-11T13:09:29Z" level=info msg="DaemonsetChecker using LabelSelector: app=daemonset-daemonset-1605100153-1605100160,source=kuberhealthy,khcheck=daemonset to remove ds pods"
time="2020-11-11T13:09:29Z" level=info msg="DaemonsetChecker waiting for 4 pods to delete"
time="2020-11-11T13:09:29Z" level=info msg="DaemonsetChecker is still removing: kuberhealthy daemonset-daemonset-1605100153-1605100160-2tltq on node gke-****-tekton-nap-n1-standard--0a7ecf20-446q"
time="2020-11-11T13:09:29Z" level=info msg="DaemonsetChecker is still removing: kuberhealthy daemonset-daemonset-1605100153-1605100160-sw5xm on node gke-****-tekton-default-pool-154aeb80-ccfi"
time="2020-11-11T13:09:29Z" level=info msg="DaemonsetChecker is still removing: kuberhealthy daemonset-daemonset-1605100153-1605100160-xh6xx on node gke-****-tekton-default-pool-154aeb80-pmxj"
time="2020-11-11T13:09:29Z" level=info msg="DaemonsetChecker is still removing: kuberhealthy daemonset-daemonset-1605100153-1605100160-xv5r8 on node gke-****-tekton-default-pool-154aeb80-n21q"
time="2020-11-11T13:09:30Z" level=debug msg="Creating Pod client."
time="2020-11-11T13:09:30Z" level=info msg="DaemonsetChecker using LabelSelector: app=daemonset-daemonset-1605100153-1605100160,source=kuberhealthy,khcheck=daemonset to remove ds pods"
time="2020-11-11T13:09:30Z" level=info msg="DaemonsetChecker waiting for 3 pods to delete"
time="2020-11-11T13:09:30Z" level=info msg="DaemonsetChecker is still removing: kuberhealthy daemonset-daemonset-1605100153-1605100160-sw5xm on node gke-****-tekton-default-pool-154aeb80-ccfi"
time="2020-11-11T13:09:30Z" level=info msg="DaemonsetChecker is still removing: kuberhealthy daemonset-daemonset-1605100153-1605100160-xh6xx on node gke-****-tekton-default-pool-154aeb80-pmxj"
time="2020-11-11T13:09:30Z" level=info msg="DaemonsetChecker is still removing: kuberhealthy daemonset-daemonset-1605100153-1605100160-xv5r8 on node gke-****-tekton-default-pool-154aeb80-n21q"
time="2020-11-11T13:09:31Z" level=debug msg="Creating Pod client."
time="2020-11-11T13:09:31Z" level=info msg="DaemonsetChecker using LabelSelector: app=daemonset-daemonset-1605100153-1605100160,source=kuberhealthy,khcheck=daemonset to remove ds pods"
time="2020-11-11T13:09:31Z" level=info msg="DaemonsetChecker waiting for 2 pods to delete"
time="2020-11-11T13:09:31Z" level=info msg="DaemonsetChecker is still removing: kuberhealthy daemonset-daemonset-1605100153-1605100160-xh6xx on node gke-****-tekton-default-pool-154aeb80-pmxj"
time="2020-11-11T13:09:31Z" level=info msg="DaemonsetChecker is still removing: kuberhealthy daemonset-daemonset-1605100153-1605100160-xv5r8 on node gke-****-tekton-default-pool-154aeb80-n21q"
time="2020-11-11T13:09:32Z" level=debug msg="Creating Pod client."
time="2020-11-11T13:09:32Z" level=info msg="DaemonsetChecker using LabelSelector: app=daemonset-daemonset-1605100153-1605100160,source=kuberhealthy,khcheck=daemonset to remove ds pods"
time="2020-11-11T13:09:32Z" level=info msg="DaemonsetChecker waiting for 2 pods to delete"
time="2020-11-11T13:09:32Z" level=info msg="DaemonsetChecker is still removing: kuberhealthy daemonset-daemonset-1605100153-1605100160-xh6xx on node gke-****-tekton-default-pool-154aeb80-pmxj"
time="2020-11-11T13:09:32Z" level=info msg="DaemonsetChecker is still removing: kuberhealthy daemonset-daemonset-1605100153-1605100160-xv5r8 on node gke-****-tekton-default-pool-154aeb80-n21q"
time="2020-11-11T13:09:33Z" level=debug msg="Creating Pod client."
time="2020-11-11T13:09:33Z" level=info msg="DaemonsetChecker using LabelSelector: app=daemonset-daemonset-1605100153-1605100160,source=kuberhealthy,khcheck=daemonset to remove ds pods"
time="2020-11-11T13:09:33Z" level=info msg="DaemonsetChecker waiting for 2 pods to delete"
time="2020-11-11T13:09:33Z" level=info msg="DaemonsetChecker is still removing: kuberhealthy daemonset-daemonset-1605100153-1605100160-xh6xx on node gke-****-tekton-default-pool-154aeb80-pmxj"
time="2020-11-11T13:09:33Z" level=info msg="DaemonsetChecker is still removing: kuberhealthy daemonset-daemonset-1605100153-1605100160-xv5r8 on node gke-****-tekton-default-pool-154aeb80-n21q"
time="2020-11-11T13:09:34Z" level=debug msg="Creating Pod client."
time="2020-11-11T13:09:34Z" level=info msg="DaemonsetChecker using LabelSelector: app=daemonset-daemonset-1605100153-1605100160,source=kuberhealthy,khcheck=daemonset to remove ds pods"
time="2020-11-11T13:09:34Z" level=info msg="DaemonsetChecker waiting for 2 pods to delete"
time="2020-11-11T13:09:34Z" level=info msg="DaemonsetChecker is still removing: kuberhealthy daemonset-daemonset-1605100153-1605100160-xh6xx on node gke-****-tekton-default-pool-154aeb80-pmxj"
time="2020-11-11T13:09:34Z" level=info msg="DaemonsetChecker is still removing: kuberhealthy daemonset-daemonset-1605100153-1605100160-xv5r8 on node gke-****-tekton-default-pool-154aeb80-n21q"
time="2020-11-11T13:09:35Z" level=debug msg="Creating Pod client."
time="2020-11-11T13:09:35Z" level=info msg="DaemonsetChecker using LabelSelector: app=daemonset-daemonset-1605100153-1605100160,source=kuberhealthy,khcheck=daemonset to remove ds pods"
time="2020-11-11T13:09:35Z" level=info msg="DaemonsetChecker waiting for 1 pods to delete"
time="2020-11-11T13:09:35Z" level=info msg="DaemonsetChecker is still removing: kuberhealthy daemonset-daemonset-1605100153-1605100160-xh6xx on node gke-****-tekton-default-pool-154aeb80-pmxj"
time="2020-11-11T13:09:36Z" level=debug msg="Creating Pod client."
time="2020-11-11T13:09:36Z" level=info msg="DaemonsetChecker using LabelSelector: app=daemonset-daemonset-1605100153-1605100160,source=kuberhealthy,khcheck=daemonset to remove ds pods"
time="2020-11-11T13:09:36Z" level=info msg="DaemonsetChecker waiting for 0 pods to delete"
time="2020-11-11T13:09:36Z" level=info msg="DaemonsetChecker has finished removing all daemonset pods"
time="2020-11-11T13:09:36Z" level=info msg="Successfully removed daemonset pods."
time="2020-11-11T13:09:36Z" level=info msg="Reporting success to Kuberhealthy."
time="2020-11-11T13:09:37Z" level=info msg="Done running daemonset check"
time="2020-11-11T13:09:37Z" level=info msg="Running post-check cleanup"
time="2020-11-11T13:09:37Z" level=debug msg="Allowing clean up 1m0s to finish."
time="2020-11-11T13:09:37Z" level=info msg="Cleaning up daemonsets and daemonset pods"
time="2020-11-11T13:09:37Z" level=debug msg="Creating Daemonset client."
time="2020-11-11T13:09:37Z" level=info msg="Finished cleanup. No rogue daemonsets or daemonset pods exist"
time="2020-11-11T13:09:37Z" level=info msg="Cleanup completed without error"
